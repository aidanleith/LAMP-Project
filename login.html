<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Login Page</title>

    <!-- Page styles (no inline CSS) -->
    <link rel="stylesheet" href="assets/styles.css" />
</head>

<body>
<header>
    <h1>Welcome back</h1>
    <p class="muted">
        Sign in to your account below. Don’t have an account?
        <a href="register.html">Sign up here</a>
    </p>
</header>

<!-- Accessibility Box -->
<aside class="a11y-box" role="complementary" aria-label="Accessibility options">
    <h2>Need an easier login time?</h2>
    <p>We’ve got you covered. Switch to a simple, accessible screen designed for folks who are low-vision, use screen readers, or prefer plain forms.</p>
    <button id="enterSimpleMode" class="a11y-btn">Use Simple Mode</button>
    <p class="a11y-note">Includes higher contrast, larger text, label-first fields, and a standard submit button.</p>
</aside>

<main class="container">
    <!-- Visual/phone UI (hidden when Simple Mode is ON) -->
    <section class="auth-shell" aria-hidden="false">
        <div class="phone-stage">
            <div class="phone">
                <div class="bezel">
                    <div class="notch"></div>

                    <div class="screen">
                        <div class="home-indicator" aria-hidden="true"></div>

                        <!-- Status bar  -->
                        <div class="status-bar" aria-hidden="true">
                            <span id="phone-time" class="time">⏻ 9:41</span>
                            <div class="status-icons">
                                <span>ᯤ 5G</span>
                                <div class="battery"><span>100%</span><div class="battery-icon"></div></div>
                            </div>
                        </div>

                        <img src="assets/contact-man.png" alt="User Icon" class="user-icon">

                        <h2 class="screen-title">Sign in to your account</h2>

                        <form id="loginForm" class="auth-form" novalidate>
                            <div class="field">
                                <input id="username" name="username" type="text"
                                       class="glass-input" placeholder="Username" required autocomplete="username">
                            </div>
                            <div class="field">
                                <input id="password" name="password" type="password"
                                       class="glass-input" placeholder="Password" required autocomplete="current-password">
                            </div>

                            <!-- Slide to Login -->
                            <div class="slide-cta" aria-label="Slide to login">
                                <div class="slide-track">
                                    <div class="slide-handle" aria-hidden="true">
                                        <span class="power">⏻</span>
                                    </div>
                                    <span class="slide-label">Slide to login</span>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="shadow-blob"></div>
            </div>
        </div>
    </section>

    <!-- Simple Mode -->
    <section class="simple-auth" aria-hidden="true" hidden>
        <h2 class="simple-title">Sign in to your account</h2>
        <form id="loginSimpleForm" class="simple-form" novalidate>
            <div class="simple-field">
                <label for="simple-username">Username</label>
                <input id="simple-username" name="username" type="text" autocomplete="username" required />
            </div>
            <div class="simple-field">
                <label for="simple-password">Password</label>
                <input id="simple-password" name="password" type="password" autocomplete="current-password" required />
            </div>
            <button type="submit" class="simple-submit">Sign in</button>
            <button type="button" id="exitSimpleMode" class="simple-secondary">Return to visual mode</button>
        </form>
    </section>
</main>

<!-- Floating reviews rail -->
<aside id="reviewsFloat" class="reviews-float" role="complementary" aria-label="User reviews" aria-live="off"></aside>

<footer class="footer">© 2025 Team 16 LAMP</footer>

<!-- time in status bar -->
<script>
    function updatePhoneTime(){
        const now=new Date();
        let h=now.getHours(), m=String(now.getMinutes()).padStart(2,"0");
        const ampm = h>=12 ? "PM":"AM";
        h=h%12; h=h?h:12;
        const el = document.getElementById("phone-time");
        if (el) el.textContent = `${h}:${m} ${ampm}`;
    }
    updatePhoneTime(); setInterval(updatePhoneTime, 60000);
</script>

<!-- slider + LOGIN via fetch -->
<script>
    (() => {
        const form   = document.getElementById('loginForm');
        const track  = document.querySelector('.slide-track');
        const handle = document.querySelector('.slide-handle');
        const label  = document.querySelector('.slide-label');
        if(!form||!track||!handle||!label) return;

        // prevent native submit
        form.addEventListener('submit', (e)=> e.preventDefault());

        let dragging=false, startX=0, minX=4, maxX;
        const THRESHOLD=0.88;

        function setBounds(){
            const r=track.getBoundingClientRect(), h=handle.getBoundingClientRect();
            maxX = r.width - h.width - 4;
        }
        setBounds();
        window.addEventListener('resize', setBounds);
        window.addEventListener('orientationchange', setBounds);

        function setPos(px){
            const x=Math.max(minX, Math.min(px,maxX));
            handle.style.left=`${x}px`;
            const progress=(x-minX)/(maxX-minX);
            label.style.opacity=String(1 - progress*0.85);
        }

        function clearErrorsOnInput(el){
            const h=()=>{ el.classList.remove('field-error'); el.removeEventListener('input', h); };
            el.addEventListener('input', h);
        }

        async function submitLogin(){
            const u=form.querySelector('#username');
            const p=form.querySelector('#password');

            let ok=true;
            [u,p].forEach(f=>{
                if(!f.value.trim()){ ok=false; f.classList.add('field-error'); clearErrorsOnInput(f); }
            });
            if(!ok) throw new Error('Please enter Username and Password');

            // UI lock
            label.textContent='Logging in…';
            handle.style.pointerEvents='none';
            window.showToast && window.showToast('Logging in…','success');

            const res = await fetch('contact_manager/api/login.php', {
                method:'POST',
                headers:{'Content-Type':'application/json'},
                body: JSON.stringify({ username: u.value.trim(), password: p.value }),
                credentials: 'same-origin'
            });

            const data = await res.json().catch(()=> ({}));
            if(!res.ok || data.error){
                throw new Error(data.error || `Login failed (${res.status})`);
            }

            window.showToast && window.showToast('Welcome back! Redirecting…','success');
            setTimeout(()=>{ window.location.href='profile.html'; }, 500);
        }

        function startDrag(e){
            dragging=true;
            startX=(e.touches?e.touches[0].clientX:e.clientX)-handle.offsetLeft;
            document.addEventListener('pointermove', onMove);
            document.addEventListener('pointerup', endDragOnce, {once:true});
            document.addEventListener('touchmove', onMove, {passive:false});
            document.addEventListener('touchend', endDragOnce, {once:true});
        }
        function onMove(e){
            if(!dragging) return;
            const x=(e.touches?e.touches[0].clientX:e.clientX)-startX;
            setPos(x); e.preventDefault();
        }
        async function endDrag(){
            dragging=false;
            const x=parseFloat(handle.style.left||'0');
            const progress=(x-minX)/(maxX-minX);

            if(progress>=THRESHOLD){
                setPos(maxX);
                try{
                    await submitLogin();
                }catch(err){
                    track.classList.add('shake'); setTimeout(()=>track.classList.remove('shake'),320);
                    window.showToast && window.showToast(err.message || 'Could not log in.','error');
                    handle.style.pointerEvents='';
                    label.textContent='Slide to login';
                    handle.style.transition='left 240ms ease'; label.style.transition='opacity 240ms ease';
                    setPos(minX);
                    setTimeout(()=>{ handle.style.transition=''; label.style.transition=''; },260);
                }
            }else{
                handle.style.transition='left 240ms ease'; label.style.transition='opacity 240ms ease';
                setPos(minX); setTimeout(()=>{ handle.style.transition=''; label.style.transition=''; },260);
            }
            document.removeEventListener('pointermove', onMove);
            document.removeEventListener('touchmove', onMove);
        }
        function endDragOnce(){ endDrag(); }

        handle.addEventListener('pointerdown', startDrag);
        handle.addEventListener('touchstart', startDrag, {passive:true});

        // Keyboard accessibility
        handle.setAttribute('tabindex','0');
        handle.addEventListener('keydown', async (e)=>{
            if(e.key==='Enter'||e.key===' '){
                setPos(maxX);
                try { await submitLogin(); }
                catch(err){
                    track.classList.add('shake'); setTimeout(()=>track.classList.remove('shake'),320);
                    window.showToast && window.showToast(err.message || 'Could not log in.','error');
                    handle.style.pointerEvents='';
                    label.textContent='Slide to login';
                    setPos(minX);
                }
            }
        });
    })();
</script>

<!-- Simple Mode toggling + simple form submit -->
<script>
    (function a11ySimpleMode(){
        const enterBtn = document.getElementById('enterSimpleMode');
        const exitBtn  = document.getElementById('exitSimpleMode');
        const simple   = document.querySelector('.simple-auth');
        const visual   = document.querySelector('.auth-shell');

        function applySimple(on){
            document.body.classList.toggle('a11y-simple', !!on);
            document.documentElement.classList.toggle('a11y-large', !!on);   // larger base text
            if(simple) { simple.hidden = !on; simple.setAttribute('aria-hidden', String(!on)); }
            if(visual) { visual.setAttribute('aria-hidden', String(!!on)); }
            try{ localStorage.setItem('a11ySimple', on ? '1' : '0'); }catch(e){}
            if(on){
                const first = document.getElementById('simple-username');
                if(first) first.focus();
            }
        }

        // Load persisted choice
        let saved = '0';
        try{ saved = localStorage.getItem('a11ySimple') || '0'; }catch(e){}
        applySimple(saved === '1');

        if(enterBtn) enterBtn.addEventListener('click', ()=> applySimple(true));
        if(exitBtn)  exitBtn.addEventListener('click',  ()=> applySimple(false));

        // Simple form submit (mirrors slider submit)
        const simpleForm = document.getElementById('loginSimpleForm');
        if(simpleForm){
            simpleForm.addEventListener('submit', async (e)=>{
                e.preventDefault();
                const u = document.getElementById('simple-username');
                const p = document.getElementById('simple-password');
                if(!u.value.trim() || !p.value){
                    window.showToast && window.showToast('Please enter Username and Password','error');
                    if(!u.value.trim()) u.focus(); else p.focus();
                    return;
                }
                //lets see if this commits
                try{
                    window.showToast && window.showToast('Logging in…','success');
                    //commit
                    const res = await fetch('http://cop4331-lamp.xyz/contact_manager/api/login.php', {
                        method:'POST',
                        headers:{'Content-Type':'application/json'},
                        body: JSON.stringify({ username: u.value.trim(), password: p.value }),
                        credentials: 'same-origin'
                    });
                    const data = await res.json().catch(()=> ({}));
                    if(!res.ok || data.error) throw new Error(data.error || `Login failed (${res.status})`);
                    window.showToast && window.showToast('Welcome back! Redirecting…','success');
                    setTimeout(()=>{ window.location.href='profile.html'; }, 500);
                }catch(err){
                    window.showToast && window.showToast(err.message || 'Could not log in.','error');
                }
            });
        }
    })();
</script>

<!-- Toast container + helper -->
<div id="toast" class="toast" role="status" aria-live="polite"></div>
<script>
    window.showToast = function (msg, type = 'info') {
        const t = document.getElementById('toast'); if (!t) return;
        t.className = `toast ${type}`;
        t.textContent = msg;
        t.classList.add('show');
        clearTimeout(window.__toastTimer);
        window.__toastTimer = setTimeout(() => t.classList.remove('show'), 2200);
    };
</script>

<!-- Floating reviews -->
<script>
    const REVIEWS = [
        { text:"I was keeping everything in a spreadsheet before this. Now I just add a contact when I meet someone, and a quick search brings them right up. Feels simple and private; My contacts stay mine.", name:"Alex N.",   title:"Freelance developer",  avatar:"AN" },
        { text:"Registration took a minute and I was off. I like that I can fix a phone number or delete a duplicate without digging through menus. It does the basics perfectly and doesn’t try to be a CRM.",    name:"Priya S.",  title:"Small-business manager",          avatar:"PS" },
        { text:"As a teacher I just need names, emails, and a note or two. Adding is fast, searching is instant, and nothing is shared by default. Exactly the right level of simple.",            name:"Diego R.",  title:"Teacher",      avatar:"DR" },
        { text:"I manage contractors and this keeps me sane. Edit, save, done. The delete actually deletes, which I appreciate. Login is straightforward and I’m in and out all day.",    name:"Maya T.",   title:"Operations Coordinator",      avatar:"MT" },
        { text:"Love the focus. I can add a contact during a call, then later search by last name to find them and update notes. No sharing headache; Just my own list that I control.",          name:"Chris L.",  title:"Real estate agent",avatar:"CL" },
        { text:"I moved off my phone’s Contacts because this is faster to type on. Search finds people even from my notes, edits are instant, and I like that nothing is shared or synced unless I say so.", name:"Hannah K.", title:"Coordinator", avatar:"HK" }
    ];

    (function multiFloat(){
        const rail = document.getElementById('reviewsFloat');
        if(!rail) return;

        const COUNT=3, DUR=20000;
        rail.innerHTML="";

        function initials(name){
            return (name||'').trim().split(/\s+/).map(s=>s[0]).slice(0,2).join('').toUpperCase() || '??';
        }
        function buildCard(startIdx){
            const card=document.createElement('div');
            card.className='float-card';
            card.style.animationDuration=(DUR/1000)+'s';
            const stars=document.createElement('div'); stars.className='stars'; stars.textContent='★★★★★'; stars.setAttribute('aria-hidden','true');
            const quote=document.createElement('blockquote');
            const meta=document.createElement('div'); meta.className='meta';
            const avatar=document.createElement('div'); avatar.className='avatar';
            const who=document.createElement('div'); who.className='who';
            const nameEl=document.createElement('strong');
            const titleEl=document.createElement('span');
            who.appendChild(nameEl); who.appendChild(titleEl);
            meta.appendChild(avatar); meta.appendChild(who);
            card.appendChild(stars); card.appendChild(quote); card.appendChild(meta);

            function setReview(n){
                const r=REVIEWS[n % REVIEWS.length];
                quote.textContent='“'+r.text+'”';
                nameEl.textContent=r.name;
                titleEl.textContent=r.title;
                avatar.textContent=(r.avatar || initials(r.name));
                card.dataset.reviewIndex=String(n);
            }

            setReview(startIdx);
            card.addEventListener('animationiteration', ()=>{
                const current=parseInt(card.dataset.reviewIndex||'0',10);
                setReview((current+COUNT)%REVIEWS.length);
            });

            return card;
        }

        for(let i=0;i<COUNT;i++){
            const card=buildCard(i%REVIEWS.length);
            card.style.animationDelay=((i*DUR/COUNT)/1000)+'s';
            rail.appendChild(card);
        }
    })();
</script>

</body>
</html>
